/* Generated by re2c 1.1.1 on Tue Dec  4 20:07:16 2018 */
#line 1 "lua-parser.re2c"
typedef struct LuaScanner {
  char *top, *last_top, *cur, *ptr, *pos, *limit;
  int line;
} LuaScanner;

#define   YYCTYPE     unsigned char
#define   YYCURSOR    s->cur
#define   YYMARKER    s->ptr
#define   YYLIMIT    s->limit

static void processNewLine(LuaScanner* s)
{
  //printf("%d:%.25s\n", s->line, s->top);
  s->pos = s->cur;
  s->line++;
}

static int scan(LuaScanner* s, char *buff_end) {

  int nest_count = 0, quote_size = 0, long_start_line;
  char *long_top;

regular:
  if (s->cur >= buff_end) {
    return TK_THEEND;
  }
  s->top = s->cur;

#line 55 "lua-parser.re2c"



#line 36 "lua-parser.re2c.c"
{
	YYCTYPE yych;
	unsigned int yyaccept = 0;
	yych = *YYCURSOR;
	switch (yych) {
	case 0x00:	goto yy2;
	case '\t':
	case '\v':
	case '\f':
	case '\r':
	case ' ':	goto yy6;
	case '\n':	goto yy8;
	case '"':	goto yy10;
	case '#':	goto yy11;
	case '%':	goto yy13;
	case '&':	goto yy15;
	case '\'':	goto yy17;
	case '(':	goto yy18;
	case ')':	goto yy20;
	case '*':	goto yy22;
	case '+':	goto yy24;
	case ',':	goto yy26;
	case '-':	goto yy28;
	case '.':	goto yy30;
	case '/':	goto yy32;
	case '0':	goto yy34;
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy36;
	case ':':	goto yy38;
	case ';':	goto yy40;
	case '<':	goto yy42;
	case '=':	goto yy44;
	case '>':	goto yy46;
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'c':
	case 'h':
	case 'j':
	case 'k':
	case 'm':
	case 'p':
	case 'q':
	case 's':
	case 'v':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	case '[':	goto yy51;
	case ']':	goto yy53;
	case '^':	goto yy55;
	case 'a':	goto yy57;
	case 'b':	goto yy58;
	case 'd':	goto yy59;
	case 'e':	goto yy60;
	case 'f':	goto yy61;
	case 'g':	goto yy62;
	case 'i':	goto yy63;
	case 'l':	goto yy64;
	case 'n':	goto yy65;
	case 'o':	goto yy66;
	case 'r':	goto yy67;
	case 't':	goto yy68;
	case 'u':	goto yy69;
	case 'w':	goto yy70;
	case '{':	goto yy71;
	case '|':	goto yy73;
	case '}':	goto yy75;
	case '~':	goto yy77;
	default:	goto yy4;
	}
yy2:
	++YYCURSOR;
#line 155 "lua-parser.re2c"
	{ goto regular; }
#line 143 "lua-parser.re2c.c"
yy4:
	++YYCURSOR;
yy5:
#line 149 "lua-parser.re2c"
	{ fprintf(stderr, "unexpected character: '%c' at line %d:%d\n",
                        *s->cur, s->line, (int)(s->cur - s->pos));
                        exit(1);
                    }
#line 152 "lua-parser.re2c.c"
yy6:
	++YYCURSOR;
#line 61 "lua-parser.re2c"
	{ goto regular; }
#line 157 "lua-parser.re2c.c"
yy8:
	++YYCURSOR;
#line 60 "lua-parser.re2c"
	{ processNewLine(s); goto regular; }
#line 162 "lua-parser.re2c.c"
yy10:
	yyaccept = 0;
	yych = *(YYMARKER = ++YYCURSOR);
	if (yych <= 0x00) goto yy5;
	goto yy80;
yy11:
	yych = *++YYCURSOR;
	switch (yych) {
	case '!':	goto yy85;
	default:	goto yy12;
	}
yy12:
#line 99 "lua-parser.re2c"
	{ return TK_LEN; }
#line 177 "lua-parser.re2c.c"
yy13:
	++YYCURSOR;
#line 97 "lua-parser.re2c"
	{ return TK_MOD; }
#line 182 "lua-parser.re2c.c"
yy15:
	++YYCURSOR;
#line 118 "lua-parser.re2c"
	{ return TK_BITAND; }
#line 187 "lua-parser.re2c.c"
yy17:
	yyaccept = 0;
	yych = *(YYMARKER = ++YYCURSOR);
	if (yych <= 0x00) goto yy5;
	goto yy89;
yy18:
	++YYCURSOR;
#line 127 "lua-parser.re2c"
	{ return TK_LPAREN; }
#line 197 "lua-parser.re2c.c"
yy20:
	++YYCURSOR;
#line 128 "lua-parser.re2c"
	{ return TK_RPAREN; }
#line 202 "lua-parser.re2c.c"
yy22:
	++YYCURSOR;
#line 96 "lua-parser.re2c"
	{ return TK_MUL; }
#line 207 "lua-parser.re2c.c"
yy24:
	++YYCURSOR;
#line 93 "lua-parser.re2c"
	{ return TK_PLUS; }
#line 212 "lua-parser.re2c.c"
yy26:
	++YYCURSOR;
#line 104 "lua-parser.re2c"
	{ return TK_COMMA; }
#line 217 "lua-parser.re2c.c"
yy28:
	yych = *++YYCURSOR;
	switch (yych) {
	case '-':	goto yy93;
	default:	goto yy29;
	}
yy29:
#line 94 "lua-parser.re2c"
	{ return TK_MINUS; }
#line 227 "lua-parser.re2c.c"
yy30:
	yych = *++YYCURSOR;
	switch (yych) {
	case '.':	goto yy95;
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy97;
	default:	goto yy31;
	}
yy31:
#line 126 "lua-parser.re2c"
	{ return TK_DOT; }
#line 247 "lua-parser.re2c.c"
yy32:
	yych = *++YYCURSOR;
	switch (yych) {
	case '/':	goto yy99;
	default:	goto yy33;
	}
yy33:
#line 95 "lua-parser.re2c"
	{ return TK_DIV; }
#line 257 "lua-parser.re2c.c"
yy34:
	yyaccept = 1;
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case '.':	goto yy97;
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy36;
	case 'X':
	case 'x':	goto yy102;
	default:	goto yy98;
	}
yy35:
#line 139 "lua-parser.re2c"
	{ return TK_NUMBER; }
#line 280 "lua-parser.re2c.c"
yy36:
	yyaccept = 1;
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case '.':	goto yy97;
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy36;
	case 'E':
	case 'e':	goto yy101;
	default:	goto yy35;
	}
yy38:
	yyaccept = 2;
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case ':':	goto yy103;
	default:	goto yy39;
	}
yy39:
#line 125 "lua-parser.re2c"
	{ return TK_COLON; }
#line 310 "lua-parser.re2c.c"
yy40:
	++YYCURSOR;
#line 124 "lua-parser.re2c"
	{ return TK_SEMICOLON; }
#line 315 "lua-parser.re2c.c"
yy42:
	yych = *++YYCURSOR;
	switch (yych) {
	case '<':	goto yy104;
	case '=':	goto yy106;
	default:	goto yy43;
	}
yy43:
#line 102 "lua-parser.re2c"
	{ return TK_LT; }
#line 326 "lua-parser.re2c.c"
yy44:
	yych = *++YYCURSOR;
	switch (yych) {
	case '=':	goto yy108;
	default:	goto yy45;
	}
yy45:
#line 92 "lua-parser.re2c"
	{ return TK_ASSIGN; }
#line 336 "lua-parser.re2c.c"
yy46:
	yych = *++YYCURSOR;
	switch (yych) {
	case '=':	goto yy110;
	case '>':	goto yy112;
	default:	goto yy47;
	}
yy47:
#line 103 "lua-parser.re2c"
	{ return TK_BT; }
#line 347 "lua-parser.re2c.c"
yy48:
	yych = *++YYCURSOR;
yy49:
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy50;
	}
yy50:
#line 136 "lua-parser.re2c"
	{ return TK_NAME; }
#line 420 "lua-parser.re2c.c"
yy51:
	yyaccept = 3;
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case '=':	goto yy114;
	case '[':	goto yy116;
	default:	goto yy52;
	}
yy52:
#line 131 "lua-parser.re2c"
	{ return TK_LBRACKET; }
#line 432 "lua-parser.re2c.c"
yy53:
	++YYCURSOR;
#line 132 "lua-parser.re2c"
	{ return TK_RBRACKET; }
#line 437 "lua-parser.re2c.c"
yy55:
	++YYCURSOR;
#line 98 "lua-parser.re2c"
	{ return TK_POW; }
#line 442 "lua-parser.re2c.c"
yy57:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'n':	goto yy118;
	default:	goto yy49;
	}
yy58:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'r':	goto yy119;
	default:	goto yy49;
	}
yy59:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'o':	goto yy120;
	default:	goto yy49;
	}
yy60:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'l':	goto yy122;
	case 'n':	goto yy123;
	default:	goto yy49;
	}
yy61:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'a':	goto yy124;
	case 'o':	goto yy125;
	case 'u':	goto yy126;
	default:	goto yy49;
	}
yy62:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'o':	goto yy127;
	default:	goto yy49;
	}
yy63:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'f':	goto yy128;
	case 'n':	goto yy130;
	default:	goto yy49;
	}
yy64:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'o':	goto yy132;
	default:	goto yy49;
	}
yy65:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'i':	goto yy133;
	case 'o':	goto yy134;
	default:	goto yy49;
	}
yy66:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'r':	goto yy135;
	default:	goto yy49;
	}
yy67:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'e':	goto yy137;
	default:	goto yy49;
	}
yy68:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'h':	goto yy138;
	case 'r':	goto yy139;
	default:	goto yy49;
	}
yy69:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'n':	goto yy140;
	default:	goto yy49;
	}
yy70:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'h':	goto yy141;
	default:	goto yy49;
	}
yy71:
	++YYCURSOR;
#line 129 "lua-parser.re2c"
	{ return TK_LBRACE; }
#line 537 "lua-parser.re2c.c"
yy73:
	++YYCURSOR;
#line 117 "lua-parser.re2c"
	{ return TK_BITOR; }
#line 542 "lua-parser.re2c.c"
yy75:
	++YYCURSOR;
#line 130 "lua-parser.re2c"
	{ return TK_RBRACE; }
#line 547 "lua-parser.re2c.c"
yy77:
	yych = *++YYCURSOR;
	switch (yych) {
	case '=':	goto yy142;
	default:	goto yy78;
	}
yy78:
#line 116 "lua-parser.re2c"
	{ return TK_BITNOT; }
#line 557 "lua-parser.re2c.c"
yy79:
	yych = *++YYCURSOR;
yy80:
	switch (yych) {
	case 0x00:	goto yy81;
	case '"':	goto yy82;
	case '\\':	goto yy84;
	default:	goto yy79;
	}
yy81:
	YYCURSOR = YYMARKER;
	switch (yyaccept) {
	case 0: 	goto yy5;
	case 1: 	goto yy35;
	case 2: 	goto yy39;
	case 3: 	goto yy52;
	case 4: 	goto yy94;
	default:	goto yy153;
	}
yy82:
	++YYCURSOR;
#line 142 "lua-parser.re2c"
	{ return TK_STRING; }
#line 581 "lua-parser.re2c.c"
yy84:
	yych = *++YYCURSOR;
	if (yych <= 0x00) goto yy81;
	goto yy79;
yy85:
	yych = *++YYCURSOR;
	switch (yych) {
	case 0x00:
	case '\n':	goto yy87;
	default:	goto yy85;
	}
yy87:
#line 145 "lua-parser.re2c"
	{ goto regular; }
#line 596 "lua-parser.re2c.c"
yy88:
	yych = *++YYCURSOR;
yy89:
	switch (yych) {
	case 0x00:	goto yy81;
	case '\'':	goto yy90;
	case '\\':	goto yy92;
	default:	goto yy88;
	}
yy90:
	++YYCURSOR;
#line 141 "lua-parser.re2c"
	{ return TK_STRING; }
#line 610 "lua-parser.re2c.c"
yy92:
	yych = *++YYCURSOR;
	if (yych <= 0x00) goto yy81;
	goto yy88;
yy93:
	yyaccept = 4;
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case '[':	goto yy144;
	default:	goto yy94;
	}
yy94:
#line 65 "lua-parser.re2c"
	{ goto Comment; }
#line 625 "lua-parser.re2c.c"
yy95:
	yych = *++YYCURSOR;
	switch (yych) {
	case '.':	goto yy146;
	default:	goto yy96;
	}
yy96:
#line 101 "lua-parser.re2c"
	{ return TK_CONCAT; }
#line 635 "lua-parser.re2c.c"
yy97:
	yyaccept = 1;
	yych = *(YYMARKER = ++YYCURSOR);
yy98:
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy97;
	case 'E':
	case 'e':	goto yy101;
	default:	goto yy35;
	}
yy99:
	++YYCURSOR;
#line 112 "lua-parser.re2c"
	{ return TK_IDIV; }
#line 659 "lua-parser.re2c.c"
yy101:
	yych = *++YYCURSOR;
	switch (yych) {
	case '+':
	case '-':	goto yy148;
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy149;
	default:	goto yy81;
	}
yy102:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':	goto yy151;
	default:	goto yy81;
	}
yy103:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case ':':	goto yy81;
	default:	goto yy155;
	}
yy104:
	++YYCURSOR;
#line 119 "lua-parser.re2c"
	{ return TK_SHL; }
#line 724 "lua-parser.re2c.c"
yy106:
	++YYCURSOR;
#line 107 "lua-parser.re2c"
	{ return TK_LTEQ; }
#line 729 "lua-parser.re2c.c"
yy108:
	++YYCURSOR;
#line 105 "lua-parser.re2c"
	{ return TK_EQ; }
#line 734 "lua-parser.re2c.c"
yy110:
	++YYCURSOR;
#line 106 "lua-parser.re2c"
	{ return TK_BTEQ; }
#line 739 "lua-parser.re2c.c"
yy112:
	++YYCURSOR;
#line 120 "lua-parser.re2c"
	{ return TK_SHR; }
#line 744 "lua-parser.re2c.c"
yy114:
	yych = *++YYCURSOR;
	switch (yych) {
	case '=':	goto yy114;
	case '[':	goto yy116;
	default:	goto yy81;
	}
yy116:
	++YYCURSOR;
#line 133 "lua-parser.re2c"
	{ long_start_line = s->line; nest_count=0; quote_size = (int)(s->cur - s->top); goto LongString; }
#line 756 "lua-parser.re2c.c"
yy118:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'd':	goto yy156;
	default:	goto yy49;
	}
yy119:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'e':	goto yy158;
	default:	goto yy49;
	}
yy120:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy121;
	}
yy121:
#line 70 "lua-parser.re2c"
	{ return TK_DO; }
#line 840 "lua-parser.re2c.c"
yy122:
	yych = *++YYCURSOR;
	switch (yych) {
	case 's':	goto yy159;
	default:	goto yy49;
	}
yy123:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'd':	goto yy160;
	default:	goto yy49;
	}
yy124:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'l':	goto yy162;
	default:	goto yy49;
	}
yy125:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'r':	goto yy163;
	default:	goto yy49;
	}
yy126:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'n':	goto yy165;
	default:	goto yy49;
	}
yy127:
	yych = *++YYCURSOR;
	switch (yych) {
	case 't':	goto yy166;
	default:	goto yy49;
	}
yy128:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy129;
	}
yy129:
#line 78 "lua-parser.re2c"
	{ return TK_IF; }
#line 948 "lua-parser.re2c.c"
yy130:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy131;
	}
yy131:
#line 79 "lua-parser.re2c"
	{ return TK_IN; }
#line 1020 "lua-parser.re2c.c"
yy132:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'c':	goto yy167;
	default:	goto yy49;
	}
yy133:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'l':	goto yy168;
	default:	goto yy49;
	}
yy134:
	yych = *++YYCURSOR;
	switch (yych) {
	case 't':	goto yy170;
	default:	goto yy49;
	}
yy135:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy136;
	}
yy136:
#line 83 "lua-parser.re2c"
	{ return TK_OR; }
#line 1110 "lua-parser.re2c.c"
yy137:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'p':	goto yy172;
	case 't':	goto yy173;
	default:	goto yy49;
	}
yy138:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'e':	goto yy174;
	default:	goto yy49;
	}
yy139:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'u':	goto yy175;
	default:	goto yy49;
	}
yy140:
	yych = *++YYCURSOR;
	switch (yych) {
	case 't':	goto yy176;
	default:	goto yy49;
	}
yy141:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'i':	goto yy177;
	default:	goto yy49;
	}
yy142:
	++YYCURSOR;
#line 108 "lua-parser.re2c"
	{ return TK_NEQ; }
#line 1146 "lua-parser.re2c.c"
yy144:
	yych = *++YYCURSOR;
	switch (yych) {
	case '=':	goto yy144;
	case '[':	goto yy178;
	default:	goto yy81;
	}
yy146:
	++YYCURSOR;
#line 100 "lua-parser.re2c"
	{ return TK_ELLIPSIS; }
#line 1158 "lua-parser.re2c.c"
yy148:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy149;
	default:	goto yy81;
	}
yy149:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy149;
	default:	goto yy35;
	}
yy151:
	yyaccept = 5;
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':	goto yy151;
	case 'P':
	case 'p':	goto yy180;
	default:	goto yy153;
	}
yy153:
#line 140 "lua-parser.re2c"
	{ return TK_NUMBER; }
#line 1222 "lua-parser.re2c.c"
yy154:
	yych = *++YYCURSOR;
yy155:
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy154;
	case ':':	goto yy181;
	default:	goto yy81;
	}
yy156:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy157;
	}
yy157:
#line 68 "lua-parser.re2c"
	{ return TK_AND; }
#line 1364 "lua-parser.re2c.c"
yy158:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'a':	goto yy182;
	default:	goto yy49;
	}
yy159:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'e':	goto yy183;
	default:	goto yy49;
	}
yy160:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy161;
	}
yy161:
#line 73 "lua-parser.re2c"
	{ return TK_END; }
#line 1448 "lua-parser.re2c.c"
yy162:
	yych = *++YYCURSOR;
	switch (yych) {
	case 's':	goto yy185;
	default:	goto yy49;
	}
yy163:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy164;
	}
yy164:
#line 75 "lua-parser.re2c"
	{ return TK_FOR; }
#line 1526 "lua-parser.re2c.c"
yy165:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'c':	goto yy186;
	default:	goto yy49;
	}
yy166:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'o':	goto yy187;
	default:	goto yy49;
	}
yy167:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'a':	goto yy189;
	default:	goto yy49;
	}
yy168:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy169;
	}
yy169:
#line 81 "lua-parser.re2c"
	{ return TK_NIL; }
#line 1616 "lua-parser.re2c.c"
yy170:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy171;
	}
yy171:
#line 82 "lua-parser.re2c"
	{ return TK_NOT; }
#line 1688 "lua-parser.re2c.c"
yy172:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'e':	goto yy190;
	default:	goto yy49;
	}
yy173:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'u':	goto yy191;
	default:	goto yy49;
	}
yy174:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'n':	goto yy192;
	default:	goto yy49;
	}
yy175:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'e':	goto yy194;
	default:	goto yy49;
	}
yy176:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'i':	goto yy196;
	default:	goto yy49;
	}
yy177:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'l':	goto yy197;
	default:	goto yy49;
	}
yy178:
	++YYCURSOR;
#line 64 "lua-parser.re2c"
	{ long_start_line = s->line; nest_count=0; quote_size = ((int)(s->cur - s->top)) - 2;  goto LongComment; }
#line 1729 "lua-parser.re2c.c"
yy180:
	yych = *++YYCURSOR;
	switch (yych) {
	case '+':
	case '-':	goto yy198;
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy199;
	default:	goto yy81;
	}
yy181:
	yych = *++YYCURSOR;
	switch (yych) {
	case ':':	goto yy201;
	default:	goto yy81;
	}
yy182:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'k':	goto yy203;
	default:	goto yy49;
	}
yy183:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	case 'i':	goto yy205;
	default:	goto yy184;
	}
yy184:
#line 71 "lua-parser.re2c"
	{ return TK_ELSE; }
#line 1830 "lua-parser.re2c.c"
yy185:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'e':	goto yy206;
	default:	goto yy49;
	}
yy186:
	yych = *++YYCURSOR;
	switch (yych) {
	case 't':	goto yy208;
	default:	goto yy49;
	}
yy187:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy188;
	}
yy188:
#line 111 "lua-parser.re2c"
	{ return TK_GOTO; }
#line 1914 "lua-parser.re2c.c"
yy189:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'l':	goto yy209;
	default:	goto yy49;
	}
yy190:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'a':	goto yy211;
	default:	goto yy49;
	}
yy191:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'r':	goto yy212;
	default:	goto yy49;
	}
yy192:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy193;
	}
yy193:
#line 86 "lua-parser.re2c"
	{ return TK_THEN; }
#line 2004 "lua-parser.re2c.c"
yy194:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy195;
	}
yy195:
#line 87 "lua-parser.re2c"
	{ return TK_TRUE; }
#line 2076 "lua-parser.re2c.c"
yy196:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'l':	goto yy213;
	default:	goto yy49;
	}
yy197:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'e':	goto yy215;
	default:	goto yy49;
	}
yy198:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy199;
	default:	goto yy81;
	}
yy199:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy199;
	default:	goto yy153;
	}
yy201:
	++YYCURSOR;
#line 113 "lua-parser.re2c"
	{ return TK_LABEL; }
#line 2123 "lua-parser.re2c.c"
yy203:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy204;
	}
yy204:
#line 69 "lua-parser.re2c"
	{ return TK_BREAK; }
#line 2195 "lua-parser.re2c.c"
yy205:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'f':	goto yy217;
	default:	goto yy49;
	}
yy206:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy207;
	}
yy207:
#line 74 "lua-parser.re2c"
	{ return TK_FALSE; }
#line 2273 "lua-parser.re2c.c"
yy208:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'i':	goto yy219;
	default:	goto yy49;
	}
yy209:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy210;
	}
yy210:
#line 80 "lua-parser.re2c"
	{ return TK_LOCAL; }
#line 2351 "lua-parser.re2c.c"
yy211:
	yych = *++YYCURSOR;
	switch (yych) {
	case 't':	goto yy220;
	default:	goto yy49;
	}
yy212:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'n':	goto yy222;
	default:	goto yy49;
	}
yy213:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy214;
	}
yy214:
#line 88 "lua-parser.re2c"
	{ return TK_UNTIL; }
#line 2435 "lua-parser.re2c.c"
yy215:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy216;
	}
yy216:
#line 89 "lua-parser.re2c"
	{ return TK_WHILE; }
#line 2507 "lua-parser.re2c.c"
yy217:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy218;
	}
yy218:
#line 72 "lua-parser.re2c"
	{ return TK_ELSEIF; }
#line 2579 "lua-parser.re2c.c"
yy219:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'o':	goto yy224;
	default:	goto yy49;
	}
yy220:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy221;
	}
yy221:
#line 84 "lua-parser.re2c"
	{ return TK_REPEAT; }
#line 2657 "lua-parser.re2c.c"
yy222:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy223;
	}
yy223:
#line 85 "lua-parser.re2c"
	{ return TK_RETURN; }
#line 2729 "lua-parser.re2c.c"
yy224:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'n':	goto yy225;
	default:	goto yy49;
	}
yy225:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy226;
	}
yy226:
#line 76 "lua-parser.re2c"
	{ return TK_FUNCTION; }
#line 2807 "lua-parser.re2c.c"
}
#line 157 "lua-parser.re2c"


LongString:
  long_top = s->cur;


#line 2816 "lua-parser.re2c.c"
{
	YYCTYPE yych;
	yych = *YYCURSOR;
	switch (yych) {
	case 0x00:	goto yy229;
	case '\n':	goto yy233;
	case '[':	goto yy235;
	case ']':	goto yy236;
	default:	goto yy231;
	}
yy229:
	++YYCURSOR;
#line 171 "lua-parser.re2c"
	{ fprintf(stderr, "unfinished long string at line %d\n", long_start_line); exit(1);}
#line 2831 "lua-parser.re2c.c"
yy231:
	++YYCURSOR;
yy232:
#line 170 "lua-parser.re2c"
	{ goto LongString; }
#line 2837 "lua-parser.re2c.c"
yy233:
	++YYCURSOR;
#line 168 "lua-parser.re2c"
	{ processNewLine(s); goto LongString; }
#line 2842 "lua-parser.re2c.c"
yy235:
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case '=':	goto yy237;
	case '[':	goto yy240;
	default:	goto yy232;
	}
yy236:
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case '=':	goto yy242;
	case ']':	goto yy244;
	default:	goto yy232;
	}
yy237:
	yych = *++YYCURSOR;
	switch (yych) {
	case '=':	goto yy237;
	case '[':	goto yy240;
	default:	goto yy239;
	}
yy239:
	YYCURSOR = YYMARKER;
	goto yy232;
yy240:
	++YYCURSOR;
#line 164 "lua-parser.re2c"
	{ int qsz = (int)(s->cur - long_top); if(qsz == quote_size) nest_count++; goto LongString; }
#line 2871 "lua-parser.re2c.c"
yy242:
	yych = *++YYCURSOR;
	switch (yych) {
	case '=':	goto yy242;
	case ']':	goto yy244;
	default:	goto yy239;
	}
yy244:
	++YYCURSOR;
	YYCURSOR -= 1;
#line 165 "lua-parser.re2c"
	{ int qsz = (int)(s->cur+1 - long_top); if( (nest_count == 0) && (qsz == quote_size)) { ++s->cur; return TK_LONGSTRING; };
                          if(qsz == quote_size) nest_count--; goto LongString; }
#line 2885 "lua-parser.re2c.c"
}
#line 173 "lua-parser.re2c"


Comment:


#line 2893 "lua-parser.re2c.c"
{
	YYCTYPE yych;
	yych = *YYCURSOR;
	switch (yych) {
	case 0x00:	goto yy249;
	case '\n':	goto yy248;
	default:	goto yy251;
	}
yy248:
#line 179 "lua-parser.re2c"
	{ return TK_COMMENT; }
#line 2905 "lua-parser.re2c.c"
yy249:
	++YYCURSOR;
#line 180 "lua-parser.re2c"
	{ goto regular; }
#line 2910 "lua-parser.re2c.c"
yy251:
	yych = *++YYCURSOR;
	switch (yych) {
	case 0x00:
	case '\n':	goto yy248;
	default:	goto yy251;
	}
}
#line 182 "lua-parser.re2c"


LongComment:
  long_top = s->cur;


#line 2926 "lua-parser.re2c.c"
{
	YYCTYPE yych;
	yych = *YYCURSOR;
	switch (yych) {
	case 0x00:	goto yy255;
	case '\n':	goto yy259;
	case '[':	goto yy261;
	case ']':	goto yy262;
	default:	goto yy257;
	}
yy255:
	++YYCURSOR;
#line 195 "lua-parser.re2c"
	{ fprintf(stderr, "unfinished long comment at line %d\n", long_start_line); exit(1);}
#line 2941 "lua-parser.re2c.c"
yy257:
	++YYCURSOR;
yy258:
#line 194 "lua-parser.re2c"
	{ goto LongComment; }
#line 2947 "lua-parser.re2c.c"
yy259:
	++YYCURSOR;
#line 193 "lua-parser.re2c"
	{ processNewLine(s); goto LongComment; }
#line 2952 "lua-parser.re2c.c"
yy261:
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case '=':	goto yy263;
	case '[':	goto yy266;
	default:	goto yy258;
	}
yy262:
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case '=':	goto yy268;
	case ']':	goto yy270;
	default:	goto yy258;
	}
yy263:
	yych = *++YYCURSOR;
	switch (yych) {
	case '=':	goto yy263;
	case '[':	goto yy266;
	default:	goto yy265;
	}
yy265:
	YYCURSOR = YYMARKER;
	goto yy258;
yy266:
	++YYCURSOR;
#line 189 "lua-parser.re2c"
	{ int qsz = (int)(s->cur - long_top); if(qsz == quote_size) nest_count++; goto LongComment; }
#line 2981 "lua-parser.re2c.c"
yy268:
	yych = *++YYCURSOR;
	switch (yych) {
	case '=':	goto yy268;
	case ']':	goto yy270;
	default:	goto yy265;
	}
yy270:
	++YYCURSOR;
	YYCURSOR -= 1;
#line 190 "lua-parser.re2c"
	{ int qsz = (int)(s->cur+1 - long_top); if( (nest_count == 0) && (qsz == quote_size)) { ++s->cur; return TK_LONGCOMMENT; };
                          if(qsz == quote_size) nest_count--; goto LongComment; }
#line 2995 "lua-parser.re2c.c"
}
#line 197 "lua-parser.re2c"


  fprintf(stderr, "impossible"); exit(1);/* die */
}

static LuaParserToken *pushToken(LuaParserState *pState, LuaScanner *scanner, int token_id) {
  LuaParserToken* token_value = malloc(sizeof(*token_value));
  token_value->flags = 0;
  token_value->token_id = token_id;
  if(scanner->last_top != scanner->top) {
    token_value->space_before_size = (int)(scanner->top - scanner->last_top);
    token_value->space_before_pos = (int)(scanner->last_top - pState->src);
  }
  else {
    token_value->space_before_size = 0;
    token_value->space_before_pos = 0;
  }
  scanner->last_top = scanner->cur;
  token_value->token_value_size = (int)(scanner->cur - scanner->top);
  token_value->token_value =  scanner->top;
  pushLuaParserToken(pState, token_value);
  return token_value;
}

int main(int argc, char *argv[]) {

  FILE *fp, *traceFile;
  long size;
  char *buff, *buff_end;
  size_t bytes;
  int token;
  LuaScanner scanner;
  LuaParserState parser_state;
  void *parser;
  //ParserCount pCount;

  int fn_argc = 1;
  int noToCompound = 0;
  int withTrace = 0;
  if(argc > 2) {
    for(; fn_argc < (argc-1); ++fn_argc) {
      if (strcmp(argv[fn_argc] , "-nc") == 0) noToCompound = 1;
#ifndef NDEBUG
      else if (strcmp(argv[fn_argc] , "-t") == 0) withTrace = 1;
#endif	    
      else {
        printf("usage : %s [options] lua_fname\n\toptions:\n\t\t-nc\tdo not convert to compound assginments\n"
#ifndef NDEBUG
                 "\t\t-t\tgenerate parser trace\n"
#endif	    
	    , argv[0]);
        exit(1);
    }
   }
  }

  /* Open input file */
  const char *fname = "test.lua";
  if(argc > 1) fname = argv[fn_argc];
  fp = fopen(fname, "r");
  if(fp == NULL) {
    fprintf(stderr, "Can't open test file\n");
    exit(-1);
  }

  if(withTrace) {
	/* Open trace file */
	traceFile = fopen("trace.out", "w");
	if(traceFile == NULL) {
	    fprintf(stderr, "Can't open trace file\n");
	    exit(-1);
	}
  }

  /* Get file size */
  fseek(fp, 0, SEEK_END);
  size = ftell(fp);
  rewind(fp);

  /*We only manage sources smaller than INT_MAX size */
  if(size > INT_MAX) {
    printf("Error file size bigger than %d\n", INT_MAX);
    exit(1);
  }

  /*
  * Allocate buffer and read, +2 just in case file do not end in '\n'
  */
  buff = (char*) malloc((size+2) * sizeof(char));
  bytes = fread(buff, 1, size, fp);
  if (bytes != size) {
    fprintf(stderr, "Error reading input file\n");
    exit(-1);
  }
  buff[size] = '\0';

  if(size > 1 && buff[size-1] != '\n') {
    /* to make things easy to parse we need a '\n' at the end */
    buff[size] = '\n';
    buff[size+1] = '\0';
    ++size;
  }

  /* Initialize scanner */
  scanner.line = 1;
  scanner.top = scanner.last_top = buff;
  scanner.cur = buff;
  scanner.pos = buff;
  scanner.ptr = buff;
  scanner.limit = buff+size;

  /* Initialize parser state */
  initializeLuaParserState(&parser_state);
  parser_state.src = buff;
  parser_state.noToCompound = noToCompound;

  /* Initialize the parser state structure */
  //pCount.numFunctionDefinitions = 0;
  //pCount.numVariableDeclarations = 0;

  /* Pointer to the end of the buffer */
  buff_end = (char*) (((char*)buff) + size);

  /* Create parser and set up tracing */
  parser = LuaParserAlloc(malloc);
#ifndef NDEBUG
  if(withTrace) LuaParserTrace(traceFile, "parser >> ");
#endif

  //printf("%d:%d:%d:%d\n", TK_SPACE, TK_COMMENT, TK_LONGCOMMENT, TK_THEEND);
  while((token = scan(&scanner, buff_end))) {
    if(token != TK_THEEND) {
      LuaParserToken *token_value = pushToken(&parser_state, &scanner, token);

      if(token < TK_LEMON_LAST_TOKEN) {
        LuaParser(parser, token, token_value, &parser_state);
      }
      else //SpecialTokens
      {
        //size_t gap_length = scanner.cur - scanner.top;
        switch(token) {
          case TK_SPACE:
            //printf("=S=%.*s=S=\n", (int)gap_length, scanner.top);
          break;
          case TK_COMMENT:
            //printf("=C=%.*s=C=\n", (int)gap_length, scanner.top);
            newStrFmt(token_value, "//%.*s", token_value->token_value_size-2, token_value->token_value+2);
          break;
          case TK_LONGCOMMENT: {
            //printf("=LC=%.*s=LC=\n", (int)gap_length, scanner.top);
            int quote_end = 4; // "--[["
            while(token_value->token_value[quote_end-1] != '[') ++quote_end; //try to find the end
            newStrFmt(token_value, "/*%.*s*/", token_value->token_value_size - quote_end - (quote_end-2), // -2 for "--"
                                                                  token_value->token_value + quote_end);
          }
          break;
        }
      }
    }
    else {
      if(scanner.last_top < buff_end) pushToken(&parser_state, &scanner, TK_SPACE);
      // Execute Parse for the last time
      LuaParser(parser, 0, NULL, &parser_state);
      break;
    }
  }
  /* Print results of parsing */
  //printf("Number of function definitions: %d.\n", pCount.numFunctionDefinitions);
  //printf("Number of variable declarations: %d.\n", pCount.numVariableDeclarations);

  /* output the reconstruction */
  doOutput(&parser_state);

  /* Deallocate parser */
  LuaParserFree(parser, free);

  resetLuaParserState(&parser_state);

  /* Close files and deallocate */
  fclose(fp);
 if(withTrace)  fclose(traceFile);
  free(buff);
  return(0);
}
